(function(){let a,b,c;b="p span div a button input h hr b i u img style link meta br hr table tr tb li ul template textarea".split(/ /),a="click dblclick error mouseover mousemove mouseup mousedown keydown keyup keypress load".split(/ /),c="style title encoding href src rel target cols width height".split(/ /),c=c.concat(a.map(a=>"on"+a));for(let b of a)null==pen.fn[b]&&(pen.fn[b]=function(a,...c){return pen.fn.on.call(this,b,a,...c)},pen.fn[b].remove=function(a,...c){return pen.fn.off.call(this,b,a,...c)},pen.fn[b].trigger=function(...a){return pen.fn.fire.call(this,...a)});for(let a of c)null==pen.fn[a]&&(pen.fn[a]=function(b){return null==b?pen.fn.attr.call(this,a):(pen.fn.attr.call(this,a,b),this)});let d={opler(a,b){null!=a.src&&"img"===b.tag&&b.attr("src",a.src),null!=a.attrs&&b.attr(a.attrs),null!=a.text&&b.html(a.text),null!=a.name&&null!=a.parent&&(a.parent[a.name]=b),null!=a.parent&&null==b.parent&&b.appendTo(a.parent)},handleChildren(a,b){let c,d,e;for(c of b){if(d=pen.type(c),"function"!==d)throw new Error("a \"child\" must be a function");if(e=c.call(a,a),null==e||!(e instanceof pen))throw new Error("the child must return and must be an instance of pen");null==e.parent&&e.appendTo(a)}},handleChildify(a,b){let c=a.tag||a.el;c=c.startsWith("<")?c:"<"+c,c+=c.endsWith(">")?"":">";let d=null==b?pen(c):b.create(c,"child");if(a.attrs&&d.attr(a.attrs),(a.text||a.html)&&d.html(a.text||a.html),a.events)for(let b in a.events)console.log(b);return a.children&&d.childify(a.children),d}};for(let a of b){let b="<"+a+">";null==pen[a]&&(pen[a]=function(c={},...e){return a=pen(b),d.opler(c,a),d.handleChildren(a,e),a}),null==pen.fn[a]&&(pen.fn[a]=function(c={},...e){return a=this.create(b,"child"),c.parent=this,d.opler(c,a),d.handleChildren(a,e),null!=c.returnEl&&c.returnEl?a:this})}pen.fn.childify=function(a){for(let b of a)d.handleChildify(b,this);return this},pen.childify=function(a){let b=[];for(let c of a)b.push(d.handleChildify(c));return 1<b.length?b:b[0]},pen.fn.eqto=function(a,b){return b=b instanceof pen?b.el:b,"this"===a?this.el===b:"parent"===a?this.parent===b:(console.warn("Unknown type: "+a+"\nResolving to 'this'"),this.el===b)}})();
